@using gpconnect_appointment_checker.Helpers
@model SearchModel

<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
        <div class="nhsuk-care-card">
            <div class="nhsuk-care-card__heading-container">
                <h3 class="nhsuk-care-card__heading"><span role="text">Searching at:</span></h3>
                <span class="nhsuk-care-card__arrow" aria-hidden="true"></span>
            </div>
            <div class="nhsuk-care-card__content"><p>@Model.SearchAtResultsText</p></div>
        </div>
        <div class="nhsuk-care-card">
            <div class="nhsuk-care-card__heading-container">
                <h3 class="nhsuk-care-card__heading"><span role="text">Searching on behalf of:</span></h3>
                <span class="nhsuk-care-card__arrow" aria-hidden="true"></span>
            </div>
            <div class="nhsuk-care-card__content"><p>@Model.SearchOnBehalfOfResultsText</p></div>
        </div>

        @if (Model.SearchResults.Count > 0)
        {
            foreach (var locationGrouping in Model.SearchResults)
            {
                var firstLocation = locationGrouping.FirstOrDefault();
                if (firstLocation != null)
                {
                    <h4>
                        @firstLocation.LocationName<br />@Html.Raw($"{string.Join(", ", firstLocation.LocationAddressLines)}, {firstLocation.LocationDistrict} {firstLocation.LocationCity} {firstLocation.LocationPostalCode} {firstLocation.LocationCountry}")
                    </h4>
                }

                <div class="nhsuk-table__panel-with-heading-tab">
                    <table role="table" class="nhsuk-table-responsive">
                        <caption class="nhsuk-table__caption nhsuk-u-visually-hidden">Available Appointment Slots</caption>
                        <thead role="rowgroup" class="nhsuk-table__head">
                            <tr role="row">
                                <th role="columnheader" class="" scope="col">Appointment date</th>
                                <th role="columnheader" class="" scope="col">Session name</th>
                                <th role="columnheader" class="" scope="col">Start time</th>
                                <th role="columnheader" class="" scope="col">Duration</th>
                                <th role="columnheader" class="" scope="col">Slot type</th>
                                <th role="columnheader" class="" scope="col">Mode of appointment</th>
                                <th role="columnheader" class="" scope="col">Practitioner</th>
                            </tr>
                        </thead>
                        <tbody class="nhsuk-table__body">
                            @foreach (var t in locationGrouping)
                            {
                                var practitionerPrefix = !string.IsNullOrEmpty(t.PractitionerPrefix) ? $"({t.PractitionerPrefix})" : string.Empty;
                                <tr role="row" class="nhsuk-table__row">
                                    <td role="cell" class="nhsuk-table__cell">@t.AppointmentDate.DateFormatter("ddd dd MMM yyyy")</td>
                                    <td role="cell" class="nhsuk-table__cell">@t.SessionName</td>
                                    <td role="cell" class="nhsuk-table__cell">@t.StartTime.DateFormatter("t")</td>
                                    <td role="cell" class="nhsuk-table__cell">@t.Duration.UnitsFormatter("mins")</td>
                                    <td role="cell" class="nhsuk-table__cell">@t.SlotType</td>
                                    <td role="cell" class="nhsuk-table__cell">@t.DeliveryChannel</td>
                                    <td role="cell" class="nhsuk-table__cell">
                                        @t.PractitionerFamilyName.ToUpper(),&nbsp;@t.PractitionerGivenName&nbsp;@practitionerPrefix
                                        <div>@t.PractitionerRole</div>
                                        <div>@t.PractitionerGender.FirstCharToUpper()</div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        }
        else
        {
            <p>No available appointment slots found</p>
        }
    </div>
</div>
